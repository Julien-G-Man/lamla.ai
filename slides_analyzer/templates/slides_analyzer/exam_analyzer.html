{% extends "base.html" %}
{% load static %}

{% block content %}
<style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800;900&display=swap');

    :root {
        --primary-color: #FFD600;
        --primary-dark: #E6C200;
        --secondary-color: #222;
        --background-white: #fff;
        --background-light: #f8fafc;
        --text-primary: #1a1a1a;
        --text-secondary: #4a5568;
        --text-muted: #718096;
        --border-light: #e2e8f0;
        --success-green: #10b981;
        --error-red: #ef4444;
        --warning-orange: #f59e0b;
        --info-blue: #3b82f6;
        --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1);
        --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.07);
        --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
        --shadow-xl: 0 20px 25px rgba(0, 0, 0, 0.1);
        --gradient-primary: linear-gradient(135deg, #FFD600 0%, #FFC107 100%);
        --gradient-secondary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --gradient-success: linear-gradient(135deg, #10b981 0%, #059669 100%);
        --gradient-info: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    body {
        font-family: 'Poppins', sans-serif;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        color: var(--text-primary);
        min-height: 100vh;
    }

    .exam-analyzer-page {
        padding: 40px 20px;
        margin-top: 72px;
        min-height: calc(100vh - 72px);
    }

    .analyzer-container {
        max-width: 1000px;
        margin: 0 auto;
        display: flex;
        flex-direction: column;
        gap: 32px;
    }

    /* Header Section */
    .analyzer-header {
        background: var(--background-white);
        border-radius: 24px;
        padding: 48px 40px;
        text-align: center;
        box-shadow: var(--shadow-xl);
        position: relative;
        overflow: hidden;
    }

    .analyzer-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 4px;
        background: var(--gradient-info);
    }

    .analyzer-header::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%233b82f6' fill-opacity='0.03'%3E%3Ccircle cx='30' cy='30' r='4'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        z-index: 0;
    }

    .analyzer-title {
        font-size: 2.5rem;
        font-weight: 900;
        color: var(--text-primary);
        margin-bottom: 16px;
        position: relative;
        z-index: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 16px;
    }

    .analyzer-emoji {
        font-size: 2.2rem;
        animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.1); }
    }

    .analyzer-subtitle {
        font-size: 1.2rem;
        color: var(--text-secondary);
        margin-bottom: 0;
        position: relative;
        z-index: 1;
        line-height: 1.6;
    }

    /* Form Section */
    .form-section {
        background: var(--background-white);
        border-radius: 24px;
        padding: 40px;
        box-shadow: var(--shadow-xl);
        position: relative;
        overflow: hidden;
    }

    .form-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 4px;
        background: var(--gradient-primary);
    }

    .section-title {
        font-size: 1.8rem;
        font-weight: 800;
        color: var(--text-primary);
        margin-bottom: 32px;
        display: flex;
        align-items: center;
        gap: 16px;
        padding-bottom: 16px;
        border-bottom: 2px solid var(--border-light);
    }

    .section-icon {
        width: 50px;
        height: 50px;
        background: var(--gradient-primary);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.3rem;
        color: var(--secondary-color);
    }

    .form-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 24px;
        margin-bottom: 32px;
    }

    .form-group {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .form-label {
        font-size: 1.1rem;
        font-weight: 700;
        color: var(--text-primary);
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .form-input, .form-textarea {
        padding: 16px 20px;
        border: 2px solid var(--border-light);
        border-radius: 12px;
        background: var(--background-white);
        color: var(--text-primary);
        font-size: 1rem;
        font-family: inherit;
        transition: var(--transition);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    .form-textarea {
        min-height: 120px;
        resize: vertical;
        line-height: 1.6;
    }

    .form-input:focus, .form-textarea:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(255, 214, 0, 0.1);
        transform: translateY(-2px);
    }

    .form-hint {
        font-size: 0.9rem;
        color: var(--text-muted);
        display: flex;
        align-items: center;
        gap: 8px;
    }

    /* File Upload Section */
    .file-upload-section {
        margin: 32px 0;
    }

    .upload-section-title {
        font-size: 1.3rem;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 24px;
        text-align: center;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
    }

    .file-upload-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
        margin-bottom: 24px;
    }

    .file-upload-slot {
        background: var(--background-light);
        border: 2px dashed var(--border-light);
        border-radius: 16px;
        padding: 24px;
        text-align: center;
        transition: var(--transition);
        position: relative;
        overflow: hidden;
        min-height: 140px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }

    .file-upload-slot::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 214, 0, 0.05), transparent);
        transition: left 0.6s;
    }

    .file-upload-slot:hover {
        border-color: var(--primary-color);
        background: rgba(255, 214, 0, 0.05);
        transform: translateY(-4px);
        box-shadow: var(--shadow-md);
    }

    .file-upload-slot:hover::before {
        left: 100%;
    }

    .file-upload-slot.has-file {
        border-color: var(--success-green);
        background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(16, 185, 129, 0.05) 100%);
        border-style: solid;
    }

    .file-upload-slot.dragover {
        border-color: var(--primary-color);
        background: rgba(255, 214, 0, 0.1);
        transform: scale(1.02);
    }

    .upload-icon {
        font-size: 2.5rem;
        color: var(--text-muted);
        margin-bottom: 12px;
        transition: var(--transition);
    }

    .file-upload-slot:hover .upload-icon {
        color: var(--primary-color);
        transform: scale(1.1);
    }

    .file-upload-slot.has-file .upload-icon {
        color: var(--success-green);
    }

    .upload-label {
        font-size: 1rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 8px;
        cursor: pointer;
    }

    .upload-description {
        font-size: 0.85rem;
        color: var(--text-muted);
        margin-bottom: 16px;
    }

    .file-input {
        position: absolute;
        opacity: 0;
        width: 100%;
        height: 100%;
        cursor: pointer;
        top: 0;
        left: 0;
    }

    .file-info {
        font-size: 0.9rem;
        color: var(--text-secondary);
        text-align: center;
        min-height: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 4px;
    }

    .file-info.has-file {
        color: var(--success-green);
        font-weight: 600;
    }

    .file-name {
        font-weight: 700;
        color: var(--text-primary);
        word-break: break-word;
    }

    .file-size {
        font-size: 0.8rem;
        color: var(--text-muted);
    }

    .remove-file-btn {
        background: var(--error-red);
        color: white;
        border: none;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        cursor: pointer;
        font-size: 0.8rem;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-top: 8px;
        transition: var(--transition);
    }

    .remove-file-btn:hover {
        background: #dc2626;
        transform: scale(1.1);
    }

    /* Upload Progress */
    .upload-progress {
        margin-top: 16px;
        display: none;
    }

    .progress-bar {
        width: 100%;
        height: 6px;
        background: #f1f5f9;
        border-radius: 3px;
        overflow: hidden;
        margin-bottom: 8px;
    }

    .progress-fill {
        height: 100%;
        background: var(--gradient-success);
        border-radius: 3px;
        transition: width 0.3s ease;
        width: 0%;
    }

    .progress-text {
        font-size: 0.8rem;
        color: var(--text-muted);
        text-align: center;
    }

    /* Action Buttons */
    .actions-row {
        display: flex;
        gap: 16px;
        justify-content: center;
        flex-wrap: wrap;
        margin-top: 32px;
    }

    .analyze-btn {
        background: var(--gradient-info);
        color: white;
        border: none;
        border-radius: 16px;
        padding: 20px 40px;
        font-size: 1.2rem;
        font-weight: 700;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
        position: relative;
        overflow: hidden;
        min-width: 200px;
    }

    .analyze-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        transition: left 0.6s;
    }

    .analyze-btn:hover {
        background: var(--secondary-color);
        color: var(--primary-color);
        transform: translateY(-4px);
        box-shadow: 0 12px 35px rgba(0, 0, 0, 0.15);
    }

    .analyze-btn:hover::before {
        left: 100%;
    }

    .analyze-btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
    }

    .clear-btn {
        background: var(--background-white);
        color: var(--text-primary);
        border: 2px solid var(--border-light);
        border-radius: 16px;
        padding: 18px 32px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: 8px;
        min-width: 140px;
        justify-content: center;
    }

    .clear-btn:hover {
        background: var(--error-red);
        color: white;
        border-color: var(--error-red);
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(239, 68, 68, 0.3);
    }

    /* Loading State */
    .loading-section {
        background: var(--background-white);
        border-radius: 24px;
        padding: 60px 40px;
        text-align: center;
        box-shadow: var(--shadow-xl);
        display: none;
    }

    .loading-section.active {
        display: block;
    }

    .loading-spinner {
        width: 60px;
        height: 60px;
        border: 6px solid #f1f5f9;
        border-top: 6px solid var(--info-blue);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 24px;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .loading-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 12px;
    }

    .loading-description {
        font-size: 1rem;
        color: var(--text-secondary);
        margin-bottom: 24px;
    }

    .loading-steps {
        display: flex;
        justify-content: center;
        gap: 16px;
        flex-wrap: wrap;
    }

    .loading-step {
        background: var(--background-light);
        border-radius: 20px;
        padding: 8px 16px;
        font-size: 0.9rem;
        color: var(--text-muted);
        display: flex;
        align-items: center;
        gap: 8px;
        transition: var(--transition);
    }

    .loading-step.active {
        background: var(--gradient-info);
        color: white;
        transform: scale(1.05);
    }

    .loading-step i {
        font-size: 0.8rem;
    }

    /* Results Section */
    .results-section {
        background: var(--background-white);
        border-radius: 24px;
        padding: 40px;
        box-shadow: var(--shadow-xl);
        position: relative;
        overflow: hidden;
    }

    .results-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 4px;
        background: var(--gradient-success);
    }

    .results-title {
        font-size: 2rem;
        font-weight: 800;
        color: var(--text-primary);
        margin-bottom: 32px;
        text-align: center;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 16px;
    }

    .ai-disclaimer {
        background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(245, 158, 11, 0.05) 100%);
        border: 2px solid rgba(245, 158, 11, 0.3);
        border-radius: 16px;
        padding: 20px;
        margin-bottom: 32px;
        display: flex;
        align-items: flex-start;
        gap: 16px;
        color: var(--warning-orange);
        font-size: 0.95rem;
        line-height: 1.6;
    }

    .disclaimer-icon {
        width: 24px;
        height: 24px;
        background: var(--warning-orange);
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.9rem;
        flex-shrink: 0;
        margin-top: 2px;
    }

    .disclaimer-text {
        flex: 1;
    }

    .disclaimer-text strong {
        color: #d97706;
        font-weight: 700;
    }

    /* Analysis Results */
    .analysis-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 32px;
    }

    .analysis-section {
        background: var(--background-light);
        border-radius: 20px;
        padding: 32px;
        border-left: 4px solid var(--info-blue);
        position: relative;
        overflow: hidden;
    }

    .analysis-section.trends {
        border-left-color: var(--success-green);
    }

    .analysis-section.predictions {
        border-left-color: var(--primary-color);
    }

    .analysis-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
        transition: left 0.6s;
    }

    .analysis-section:hover::before {
        left: 100%;
    }

    .analysis-section-title {
        font-size: 1.5rem;
        font-weight: 800;
        color: var(--text-primary);
        margin-bottom: 24px;
        display: flex;
        align-items: center;
        gap: 12px;
        padding-bottom: 12px;
        border-bottom: 2px solid var(--border-light);
    }

    .analysis-section-icon {
        width: 40px;
        height: 40px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.1rem;
        color: white;
    }

    .trends .analysis-section-icon {
        background: var(--gradient-success);
    }

    .predictions .analysis-section-icon {
        background: var(--gradient-primary);
        color: var(--secondary-color);
    }

    .analysis-list {
        list-style: none;
        padding: 0;
        margin: 0;
        display: flex;
        flex-direction: column;
        gap: 16px;
    }

    .analysis-item {
        background: var(--background-white);
        border-radius: 12px;
        padding: 20px;
        box-shadow: var(--shadow-sm);
        transition: var(--transition);
        position: relative;
        border-left: 3px solid transparent;
    }

    .analysis-item:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
        border-left-color: var(--primary-color);
    }

    .trends .analysis-item:hover {
        border-left-color: var(--success-green);
    }

    .analysis-item-content {
        font-size: 1rem;
        line-height: 1.6;
        color: var(--text-primary);
    }

    .analysis-item-content strong {
        color: var(--text-primary);
        font-weight: 700;
    }

    /* Error Message */
    .error-message {
        background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(239, 68, 68, 0.05) 100%);
        border: 2px solid rgba(239, 68, 68, 0.3);
        border-radius: 16px;
        padding: 20px;
        color: var(--error-red);
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 12px;
        margin-top: 24px;
    }

    .error-icon {
        width: 24px;
        height: 24px;
        background: var(--error-red);
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.9rem;
        flex-shrink: 0;
    }

    /* Toast Notifications */
    .toast {
        position: fixed;
        top: 100px;
        right: 24px;
        padding: 16px 24px;
        border-radius: 12px;
        box-shadow: var(--shadow-lg);
        font-weight: 600;
        z-index: 10000;
        display: none;
        animation: slideIn 0.3s ease;
        max-width: 350px;
    }

    .toast.success {
        background: var(--gradient-success);
        color: white;
    }

    .toast.error {
        background: var(--gradient-error);
        color: white;
    }

    .toast.info {
        background: var(--gradient-info);
        color: white;
    }

    @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        .exam-analyzer-page {
            padding: 20px 16px;
            margin-top: 64px;
        }

        .analyzer-header {
            padding: 32px 24px;
        }

        .analyzer-title {
            font-size: 2rem;
            flex-direction: column;
            gap: 12px;
        }

        .form-section, .results-section {
            padding: 32px 24px;
        }

        .section-title {
            font-size: 1.5rem;
            flex-direction: column;
            gap: 12px;
            text-align: center;
        }

        .file-upload-grid {
            grid-template-columns: 1fr;
            gap: 16px;
        }

        .file-upload-slot {
            min-height: 120px;
            padding: 20px;
        }

        .upload-icon {
            font-size: 2rem;
        }

        .actions-row {
            flex-direction: column;
            align-items: center;
        }

        .analyze-btn, .clear-btn {
            width: 100%;
            max-width: 300px;
        }

        .loading-steps {
            flex-direction: column;
            align-items: center;
        }

        .analysis-grid {
            gap: 24px;
        }

        .analysis-section {
            padding: 24px 20px;
        }
    }

    @media (max-width: 480px) {
        .exam-analyzer-page {
            padding: 16px 12px;
        }

        .analyzer-header {
            padding: 24px 20px;
            border-radius: 16px;
        }

        .analyzer-title {
            font-size: 1.8rem;
        }

        .form-section, .results-section {
            padding: 24px 20px;
            border-radius: 16px;
        }

        .file-upload-slot {
            min-height: 100px;
            padding: 16px;
        }

        .upload-icon {
            font-size: 1.8rem;
        }

        .analyze-btn {
            padding: 16px 32px;
            font-size: 1.1rem;
        }

        .clear-btn {
            padding: 14px 24px;
            font-size: 1rem;
        }
    }
</style>

<div class="exam-analyzer-page">
    <div class="analyzer-container">
        <!-- Header Section -->
        <div class="analyzer-header">
            <h1 class="analyzer-title">
                <span class="analyzer-emoji">🔍</span>
                Smart Exam Analyzer
            </h1>
            <p class="analyzer-subtitle">
                Upload multiple past exam documents to analyze trends, identify patterns, and predict future questions. 
                Our AI will help you understand what topics are most likely to appear on your upcoming exams.
            </p>
        </div>

        <!-- Form Section -->
        <div class="form-section">
            <h2 class="section-title">
                <div class="section-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                Analyze Exam Materials
            </h2>

            <form id="analyzerForm" method="post" enctype="multipart/form-data" action="{% url 'exam_analyzer' %}">
                {% csrf_token %}
                
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label" for="subject">
                            <i class="fas fa-book"></i>
                            Subject/Topic
                        </label>
                        <input 
                            type="text" 
                            id="subject" 
                            name="subject" 
                            class="form-input"
                            placeholder="e.g., Physics, Mathematics, History, Computer Science..."
                            required>
                        <div class="form-hint">
                            <i class="fas fa-info-circle"></i>
                            Enter the subject or topic area for your exam analysis
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="context">
                            <i class="fas fa-comment-alt"></i>
                            Additional Context (Optional)
                        </label>
                        <textarea 
                            id="context" 
                            name="context" 
                            class="form-textarea"
                            placeholder="Add any additional context, specific areas of interest, exam format details, or background information that might help with the analysis..."></textarea>
                        <div class="form-hint">
                            <i class="fas fa-lightbulb"></i>
                            Provide context to get more targeted analysis results
                        </div>
                    </div>
                </div>

                <!-- File Upload Section -->
                <div class="file-upload-section">
                    <h3 class="upload-section-title">
                        <i class="fas fa-cloud-upload-alt"></i>
                        Upload Exam Documents (Up to 5 files)
                    </h3>
                    
                    <div class="file-upload-grid">
                        {% for i in "12345" %}
                        <div class="file-upload-slot" id="slot_{{ i }}">
                            <div class="upload-icon">
                                <i class="fas fa-file-upload"></i>
                            </div>
                            <label class="upload-label" for="exam_file_{{ i }}">
                                Upload File {{ i }}
                            </label>
                            <div class="upload-description">
                                PDF, DOCX, PPTX, TXT
                            </div>
                            <input 
                                type="file" 
                                name="exam_file_{{ i }}" 
                                id="exam_file_{{ i }}" 
                                accept=".pdf,.docx,.pptx,.txt" 
                                class="file-input">
                            <div class="file-info" id="file_info_{{ i }}"></div>
                            <div class="upload-progress" id="progress_{{ i }}">
                                <div class="progress-bar">
                                    <div class="progress-fill"></div>
                                </div>
                                <div class="progress-text">Uploading...</div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <div class="actions-row">
                    <button type="submit" class="analyze-btn" id="analyzeBtn">
                        <i class="fas fa-brain"></i>
                        Analyze Documents
                    </button>
                    <button type="button" class="clear-btn" id="clearBtn">
                        <i class="fas fa-trash-alt"></i>
                        Clear All
                    </button>
                </div>
            </form>
        </div>

        <!-- Loading Section -->
        <div class="loading-section" id="loadingSection">
            <div class="loading-spinner"></div>
            <h3 class="loading-title">Analyzing Your Documents</h3>
            <p class="loading-description">Our AI is processing your exam materials to identify patterns and trends</p>
            <div class="loading-steps">
                <div class="loading-step active" id="step1">
                    <i class="fas fa-file-text"></i>
                    <span>Extracting Text</span>
                </div>
                <div class="loading-step" id="step2">
                    <i class="fas fa-search"></i>
                    <span>Analyzing Patterns</span>
                </div>
                <div class="loading-step" id="step3">
                    <i class="fas fa-chart-line"></i>
                    <span>Identifying Trends</span>
                </div>
                <div class="loading-step" id="step4">
                    <i class="fas fa-crystal-ball"></i>
                    <span>Making Predictions</span>
                </div>
            </div>
        </div>

        {% if analysis_results %}
        <!-- Results Section -->
        <div class="results-section">
            <h2 class="results-title">
                <i class="fas fa-chart-bar"></i>
                Analysis Results
            </h2>

            <div class="ai-disclaimer">
                <div class="disclaimer-icon">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="disclaimer-text">
                    <strong>AI-Generated Analysis Disclaimer:</strong> This analysis is generated by artificial intelligence and may contain errors, inaccuracies, or incomplete information. Please use this as a supplementary tool and verify all insights with your course materials and instructors.
                </div>
            </div>

            <div class="analysis-grid">
                {% if analysis_results.trends %}
                <div class="analysis-section trends">
                    <h3 class="analysis-section-title">
                        <div class="analysis-section-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        Identified Trends
                    </h3>
                    <ul class="analysis-list">
                        {% for trend in analysis_results.trends %}
                        <li class="analysis-item">
                            <div class="analysis-item-content">{{ trend }}</div>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}

                {% if analysis_results.predictions %}
                <div class="analysis-section predictions">
                    <h3 class="analysis-section-title">
                        <div class="analysis-section-icon">
                            <i class="fas fa-crystal-ball"></i>
                        </div>
                        Predicted Focus Areas
                    </h3>
                    <ul class="analysis-list">
                        {% for prediction in analysis_results.predictions %}
                        <li class="analysis-item">
                            <div class="analysis-item-content">{{ prediction }}</div>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}
            </div>
        </div>
        {% endif %}

        {% if error_message %}
        <!-- Error Message -->
        <div class="error-message">
            <div class="error-icon">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <div>{{ error_message }}</div>
        </div>
        {% endif %}
    </div>
</div>

<!-- Toast Container -->
<div class="toast" id="toast"></div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const analyzerForm = document.getElementById('analyzerForm');
        const clearBtn = document.getElementById('clearBtn');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const loadingSection = document.getElementById('loadingSection');
        const toast = document.getElementById('toast');

        // File upload handling
        for (let i = 1; i <= 5; i++) {
            const fileInput = document.getElementById(`exam_file_${i}`);
            const fileInfo = document.getElementById(`file_info_${i}`);
            const slot = document.getElementById(`slot_${i}`);

            // File input change event
            fileInput.addEventListener('change', function() {
                handleFileSelect(this, fileInfo, slot, i);
            });

            // Drag and drop events
            slot.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.classList.add('dragover');
            });

            slot.addEventListener('dragleave', function(e) {
                e.preventDefault();
                this.classList.remove('dragover');
            });

            slot.addEventListener('drop', function(e) {
                e.preventDefault();
                this.classList.remove('dragover');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    fileInput.files = files;
                    handleFileSelect(fileInput, fileInfo, slot, i);
                }
            });
        }

        function handleFileSelect(input, infoDiv, slot, index) {
            const file = input.files[0];
            if (file) {
                const fileSize = (file.size / 1024 / 1024).toFixed(2);
                const fileName = file.name.length > 25 ? file.name.substring(0, 25) + '...' : file.name;
                
                infoDiv.innerHTML = `
                    <div class="file-name">${fileName}</div>
                    <div class="file-size">${fileSize} MB</div>
                    <button type="button" class="remove-file-btn" onclick="removeFile(${index})">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                infoDiv.className = 'file-info has-file';
                slot.classList.add('has-file');
                
                // Show success message
                showToast(`File "${file.name}" uploaded successfully!`, 'success');
            } else {
                infoDiv.innerHTML = '';
                infoDiv.className = 'file-info';
                slot.classList.remove('has-file');
            }
        }

        // Remove file function
        window.removeFile = function(index) {
            const fileInput = document.getElementById(`exam_file_${index}`);
            const fileInfo = document.getElementById(`file_info_${index}`);
            const slot = document.getElementById(`slot_${index}`);
            
            fileInput.value = '';
            fileInfo.innerHTML = '';
            fileInfo.className = 'file-info';
            slot.classList.remove('has-file');
            
            showToast('File removed successfully!', 'info');
        };

        // Clear form
        clearBtn.addEventListener('click', function() {
            // Clear text inputs
            document.getElementById('subject').value = '';
            document.getElementById('context').value = '';
            
            // Clear all file inputs
            for (let i = 1; i <= 5; i++) {
                removeFile(i);
            }
            
            showToast('Form cleared successfully!', 'info');
        });

        // Form submission
        analyzerForm.addEventListener('submit', function(e) {
            const subject = document.getElementById('subject').value.trim();
            
            // Check if at least one file is uploaded
            let hasFiles = false;
            for (let i = 1; i <= 5; i++) {
                if (document.getElementById(`exam_file_${i}`).files.length > 0) {
                    hasFiles = true;
                    break;
                }
            }

            if (!subject) {
                e.preventDefault();
                showToast('Please enter a subject/topic', 'error');
                return;
            }

            if (!hasFiles) {
                e.preventDefault();
                showToast('Please upload at least one exam document', 'error');
                return;
            }

            // Show loading state
            showLoadingState();
        });

        function showLoadingState() {
            loadingSection.classList.add('active');
            analyzeBtn.disabled = true;
            analyzeBtn.innerHTML = '<div class="loading-spinner" style="width: 20px; height: 20px; border-width: 3px; margin-right: 8px;"></div> Analyzing...';
            
            // Simulate loading steps
            const steps = ['step1', 'step2', 'step3', 'step4'];
            let currentStep = 0;
            
            const stepInterval = setInterval(() => {
                if (currentStep > 0) {
                    document.getElementById(steps[currentStep - 1]).classList.remove('active');
                }
                if (currentStep < steps.length) {
                    document.getElementById(steps[currentStep]).classList.add('active');
                    currentStep++;
                } else {
                    clearInterval(stepInterval);
                }
            }, 2000);
        }

        function showToast(message, type) {
            toast.textContent = message;
            toast.className = `toast ${type}`;
            toast.style.display = 'block';
            
            setTimeout(() => {
                toast.style.display = 'none';
            }, 4000);
        }

        // File validation
        function validateFile(file) {
            const allowedTypes = ['application/pdf', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document', 
                                'application/vnd.openxmlformats-officedocument.presentationml.presentation', 'text/plain'];
            const maxSize = 10 * 1024 * 1024; // 10MB

            if (!allowedTypes.includes(file.type)) {
                showToast('Please upload only PDF, DOCX, PPTX, or TXT files', 'error');
                return false;
            }

            if (file.size > maxSize) {
                showToast('File size must be less than 10MB', 'error');
                return false;
            }

            return true;
        }

        // Enhanced file input validation
        document.querySelectorAll('.file-input').forEach(input => {
            input.addEventListener('change', function() {
                if (this.files[0] && !validateFile(this.files[0])) {
                    this.value = '';
                    return;
                }
            });
        });
    });
</script>
{% endblock %}
