{% extends "base.html" %}
{% load static %}

{% block content %}
<style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800;900&display=swap');

    :root {
        --primary-color: #FFD600;
        --primary-dark: #E6C200;
        --secondary-color: #222;
        --background-white: #fff;
        --background-light: #f8fafc;
        --text-primary: #1a1a1a;
        --text-secondary: #4a5568;
        --text-muted: #718096;
        --border-light: #e2e8f0;
        --success-green: #10b981;
        --error-red: #ef4444;
        --warning-orange: #f59e0b;
        --info-blue: #3b82f6;
        --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1);
        --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.07);
        --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
        --shadow-xl: 0 20px 25px rgba(0, 0, 0, 0.1);
        --gradient-primary: linear-gradient(135deg, #FFD600 0%, #FFC107 100%);
        --gradient-secondary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --gradient-success: linear-gradient(135deg, #10b981 0%, #059669 100%);
        --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    body {
        font-family: 'Poppins', sans-serif;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        color: var(--text-primary);
        min-height: 100vh;
    }

    .flashcards-page {
        padding: 40px 20px;
        margin-top: 72px;
        min-height: calc(100vh - 72px);
    }

    .flashcards-container {
        max-width: 1000px;
        margin: 0 auto;
        display: flex;
        flex-direction: column;
        gap: 32px;
    }

    /* Header Section */
    .flashcards-header {
        background: var(--background-white);
        border-radius: 24px;
        padding: 48px 40px;
        text-align: center;
        box-shadow: var(--shadow-xl);
        position: relative;
        overflow: hidden;
    }

    .flashcards-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 4px;
        background: var(--gradient-primary);
    }

    .flashcards-header::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23FFD600' fill-opacity='0.03'%3E%3Ccircle cx='30' cy='30' r='4'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        z-index: 0;
    }

    .flashcards-title {
        font-size: 2.5rem;
        font-weight: 900;
        color: var(--text-primary);
        margin-bottom: 16px;
        position: relative;
        z-index: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 16px;
    }

    .flashcards-emoji {
        font-size: 2.2rem;
        animation: flip 3s ease-in-out infinite;
    }

    @keyframes flip {
        0%, 100% { transform: rotateY(0deg); }
        50% { transform: rotateY(180deg); }
    }

    .flashcards-subtitle {
        font-size: 1.2rem;
        color: var(--text-secondary);
        margin-bottom: 0;
        position: relative;
        z-index: 1;
    }

    /* Form Section */
    .form-section {
        background: var(--background-white);
        border-radius: 24px;
        padding: 40px;
        box-shadow: var(--shadow-xl);
        position: relative;
        overflow: hidden;
    }

    .form-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 4px;
        background: var(--gradient-secondary);
    }

    .section-title {
        font-size: 1.8rem;
        font-weight: 800;
        color: var(--text-primary);
        margin-bottom: 32px;
        display: flex;
        align-items: center;
        gap: 16px;
        padding-bottom: 16px;
        border-bottom: 2px solid var(--border-light);
    }

    .section-icon {
        width: 50px;
        height: 50px;
        background: var(--gradient-secondary);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.3rem;
        color: white;
    }

    .form-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 24px;
        margin-bottom: 32px;
    }

    .form-group {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .form-label {
        font-size: 1.1rem;
        font-weight: 700;
        color: var(--text-primary);
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .form-input, .form-textarea, .form-select {
        padding: 16px 20px;
        border: 2px solid var(--border-light);
        border-radius: 12px;
        background: var(--background-white);
        color: var(--text-primary);
        font-size: 1rem;
        font-family: inherit;
        transition: var(--transition);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    .form-textarea {
        min-height: 150px;
        resize: vertical;
        line-height: 1.6;
    }

    .form-select {
        appearance: none;
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
        background-position: right 16px center;
        background-repeat: no-repeat;
        background-size: 16px;
        padding-right: 48px;
    }

    .form-input:focus, .form-textarea:focus, .form-select:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(255, 214, 0, 0.1);
        transform: translateY(-2px);
    }

    .form-hint {
        font-size: 0.9rem;
        color: var(--text-muted);
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .generate-btn {
        background: var(--gradient-primary);
        color: var(--secondary-color);
        border: none;
        border-radius: 16px;
        padding: 20px 40px;
        font-size: 1.2rem;
        font-weight: 700;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        box-shadow: 0 8px 25px rgba(255, 214, 0, 0.4);
        position: relative;
        overflow: hidden;
        width: 100%;
    }

    .generate-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        transition: left 0.6s;
    }

    .generate-btn:hover {
        background: var(--secondary-color);
        color: var(--primary-color);
        transform: translateY(-4px);
        box-shadow: 0 12px 35px rgba(0, 0, 0, 0.15);
    }

    .generate-btn:hover::before {
        left: 100%;
    }

    .generate-btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
    }

    /* Flashcard Display Section */
    .flashcard-display {
        background: var(--background-white);
        border-radius: 24px;
        padding: 40px;
        box-shadow: var(--shadow-xl);
        position: relative;
        overflow: hidden;
    }

    .flashcard-display::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 4px;
        background: var(--gradient-success);
    }

    .flashcard-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 32px;
        padding-bottom: 16px;
        border-bottom: 2px solid var(--border-light);
    }

    .flashcard-counter {
        background: linear-gradient(135deg, rgba(255, 214, 0, 0.1) 0%, rgba(255, 214, 0, 0.05) 100%);
        border: 2px solid rgba(255, 214, 0, 0.3);
        border-radius: 20px;
        padding: 8px 16px;
        font-size: 0.9rem;
        font-weight: 700;
        color: var(--primary-color);
    }

    /* Progress Bar */
    .progress-container {
        margin-bottom: 32px;
    }

    .progress-label {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
    }

    .progress-title {
        font-size: 1rem;
        font-weight: 700;
        color: var(--text-primary);
    }

    .progress-percentage {
        font-size: 0.9rem;
        font-weight: 600;
        color: var(--success-green);
    }

    .progress-bar {
        height: 8px;
        background: #f1f5f9;
        border-radius: 4px;
        overflow: hidden;
        position: relative;
        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .progress-fill {
        height: 100%;
        background: var(--gradient-success);
        border-radius: 4px;
        transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
    }

    .progress-fill::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
        animation: shimmer 2s ease-in-out infinite;
    }

    @keyframes shimmer {
        0% { left: -100%; }
        100% { left: 100%; }
    }

    /* Flashcard */
    .flashcard {
        background: var(--background-white);
        border-radius: 20px;
        min-height: 300px;
        margin: 32px 0;
        cursor: pointer;
        transition: var(--transition);
        position: relative;
        perspective: 1000px;
        box-shadow: var(--shadow-lg);
    }

    .flashcard-inner {
        position: relative;
        width: 100%;
        height: 100%;
        min-height: 300px;
        text-align: center;
        transition: transform 0.8s;
        transform-style: preserve-3d;
    }

    .flashcard.flipped .flashcard-inner {
        transform: rotateY(180deg);
    }

    .flashcard-front, .flashcard-back {
        position: absolute;
        width: 100%;
        height: 100%;
        min-height: 300px;
        backface-visibility: hidden;
        border-radius: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 40px;
        box-sizing: border-box;
        font-size: 1.4rem;
        font-weight: 600;
        line-height: 1.6;
        text-align: center;
    }

    .flashcard-front {
        background: var(--gradient-primary);
        color: var(--secondary-color);
        border: 3px solid rgba(255, 214, 0, 0.3);
    }

    .flashcard-back {
        background: var(--gradient-secondary);
        color: white;
        transform: rotateY(180deg);
        border: 3px solid rgba(102, 126, 234, 0.3);
    }

    .flashcard:hover {
        transform: translateY(-8px);
        box-shadow: var(--shadow-xl);
    }

    .flip-hint {
        position: absolute;
        bottom: 16px;
        right: 16px;
        background: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 8px 12px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 500;
        opacity: 0.8;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    /* Navigation Controls */
    .flashcard-nav {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 24px;
        margin: 32px 0;
    }

    .nav-btn {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        border: none;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.3rem;
        box-shadow: var(--shadow-md);
        position: relative;
        overflow: hidden;
    }

    .nav-btn.prev, .nav-btn.next {
        background: var(--gradient-primary);
        color: var(--secondary-color);
    }

    .nav-btn.flip {
        background: var(--gradient-secondary);
        color: white;
        width: 70px;
        height: 70px;
        font-size: 1.5rem;
    }

    .nav-btn:hover {
        transform: translateY(-4px) scale(1.1);
        box-shadow: var(--shadow-lg);
    }

    .nav-btn:disabled {
        opacity: 0.4;
        cursor: not-allowed;
        transform: none;
    }

    .nav-btn:disabled:hover {
        transform: none;
        box-shadow: var(--shadow-md);
    }

    .nav-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        transition: left 0.6s;
    }

    .nav-btn:hover::before {
        left: 100%;
    }

    /* Keyboard Shortcuts */
    .keyboard-shortcuts {
        background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(59, 130, 246, 0.05) 100%);
        border: 2px solid rgba(59, 130, 246, 0.3);
        border-radius: 16px;
        padding: 20px;
        margin: 24px 0;
        text-align: center;
    }

    .shortcuts-title {
        font-size: 1rem;
        font-weight: 700;
        color: var(--info-blue);
        margin-bottom: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
    }

    .shortcuts-list {
        display: flex;
        justify-content: center;
        gap: 24px;
        flex-wrap: wrap;
    }

    .shortcut-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 0.9rem;
        color: var(--text-secondary);
    }

    .shortcut-key {
        background: var(--info-blue);
        color: white;
        padding: 4px 8px;
        border-radius: 6px;
        font-size: 0.8rem;
        font-weight: 700;
        min-width: 24px;
        text-align: center;
    }

    /* Download Section */
    .download-section {
        background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(16, 185, 129, 0.05) 100%);
        border: 2px solid rgba(16, 185, 129, 0.3);
        border-radius: 20px;
        padding: 32px;
        text-align: center;
        margin-top: 32px;
    }

    .download-title {
        font-size: 1.5rem;
        font-weight: 800;
        color: var(--success-green);
        margin-bottom: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
    }

    .download-description {
        font-size: 1rem;
        color: var(--text-secondary);
        margin-bottom: 24px;
    }

    .download-buttons {
        display: flex;
        justify-content: center;
        gap: 16px;
        flex-wrap: wrap;
    }

    .download-btn {
        background: var(--gradient-success);
        color: white;
        border: none;
        border-radius: 12px;
        padding: 14px 24px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: 8px;
        box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        min-width: 140px;
        justify-content: center;
    }

    .download-btn:hover {
        background: #059669;
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
    }

    /* Error Message */
    .error-message {
        background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(239, 68, 68, 0.05) 100%);
        border: 2px solid rgba(239, 68, 68, 0.3);
        border-radius: 16px;
        padding: 20px;
        color: var(--error-red);
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .error-icon {
        width: 24px;
        height: 24px;
        background: var(--error-red);
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.9rem;
        flex-shrink: 0;
    }

    /* Loading State */
    .loading-spinner {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid rgba(255, 214, 0, 0.3);
        border-top: 3px solid var(--primary-color);
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        .flashcards-page {
            padding: 20px 16px;
            margin-top: 64px;
        }

        .flashcards-header {
            padding: 32px 24px;
        }

        .flashcards-title {
            font-size: 2rem;
            flex-direction: column;
            gap: 12px;
        }

        .form-section, .flashcard-display {
            padding: 32px 24px;
        }

        .section-title {
            font-size: 1.5rem;
            flex-direction: column;
            gap: 12px;
            text-align: center;
        }

        .flashcard-front, .flashcard-back {
            padding: 24px;
            font-size: 1.2rem;
            min-height: 250px;
        }

        .flashcard-nav {
            gap: 16px;
        }

        .nav-btn {
            width: 50px;
            height: 50px;
            font-size: 1.1rem;
        }

        .nav-btn.flip {
            width: 60px;
            height: 60px;
            font-size: 1.3rem;
        }

        .shortcuts-list {
            flex-direction: column;
            gap: 12px;
        }

        .download-buttons {
            flex-direction: column;
            align-items: center;
        }

        .download-btn {
            width: 100%;
            max-width: 300px;
        }
    }

    @media (max-width: 480px) {
        .flashcards-page {
            padding: 16px 12px;
        }

        .flashcards-header {
            padding: 24px 20px;
            border-radius: 16px;
        }

        .flashcards-title {
            font-size: 1.8rem;
        }

        .form-section, .flashcard-display {
            padding: 24px 20px;
            border-radius: 16px;
        }

        .flashcard-front, .flashcard-back {
            padding: 20px;
            font-size: 1.1rem;
            min-height: 200px;
        }

        .generate-btn {
            padding: 16px 32px;
            font-size: 1.1rem;
        }

        .nav-btn {
            width: 45px;
            height: 45px;
            font-size: 1rem;
        }

        .nav-btn.flip {
            width: 55px;
            height: 55px;
            font-size: 1.2rem;
        }
    }
</style>

<div class="flashcards-page">
    <div class="flashcards-container">
        <!-- Header Section -->
        <div class="flashcards-header">
            <h1 class="flashcards-title">
                <span class="flashcards-emoji">üÉè</span>
                Smart Flashcards
            </h1>
            <p class="flashcards-subtitle">Transform your study materials into interactive flashcards for effective learning</p>
        </div>

        <!-- Form Section -->
        <div class="form-section">
            <h2 class="section-title">
                <div class="section-icon">
                    <i class="fas fa-magic"></i>
                </div>
                Generate Flashcards
            </h2>

            <form id="flashcardForm" method="post">
                {% csrf_token %}
                
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label" for="extractedText">
                            <i class="fas fa-file-text"></i>
                            Study Material Text
                        </label>
                        <textarea 
                            id="extractedText" 
                            name="extractedText" 
                            class="form-textarea"
                            placeholder="Paste your study material text here... The AI will analyze your content and create relevant flashcards to help you learn effectively."
                            required>{{ extracted_text|default:'' }}</textarea>
                        <div class="form-hint">
                            <i class="fas fa-info-circle"></i>
                            Paste notes, textbook content, or any study material you want to convert into flashcards
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="flashcard_type">
                            <i class="fas fa-tags"></i>
                            Flashcard Type
                        </label>
                        <select id="flashcard_type" name="flashcard_type" class="form-select">
                            <option value="general" {% if flashcard_type == 'general' %}selected{% endif %}>General Flashcards</option>
                            <option value="vocabulary" {% if flashcard_type == 'vocabulary' %}selected{% endif %}>Vocabulary Flashcards</option>
                            <option value="concepts" {% if flashcard_type == 'concepts' %}selected{% endif %}>Concept Flashcards</option>
                            <option value="definitions" {% if flashcard_type == 'definitions' %}selected{% endif %}>Definition Flashcards</option>
                        </select>
                        <div class="form-hint">
                            <i class="fas fa-lightbulb"></i>
                            Choose the type that best matches your study goals
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="num_flashcards">
                            <i class="fas fa-hashtag"></i>
                            Number of Flashcards
                        </label>
                        <input 
                            type="number" 
                            id="num_flashcards" 
                            name="num_flashcards" 
                            class="form-input"
                            min="1" 
                            max="50" 
                            value="{{ num_flashcards|default:10 }}" 
                            required>
                        <div class="form-hint">
                            <i class="fas fa-chart-line"></i>
                            Recommended: 10-20 flashcards for optimal learning sessions
                        </div>
                    </div>
                </div>

                <button type="submit" class="generate-btn" id="generateBtn">
                    <i class="fas fa-sparkles"></i>
                    Generate Flashcards
                </button>
            </form>
        </div>

        {% if flashcard_results %}
        <!-- Flashcard Display Section -->
        <div class="flashcard-display">
            <div class="flashcard-header">
                <h2 class="section-title">
                    <div class="section-icon">
                        <i class="fas fa-clone"></i>
                    </div>
                    Your Flashcards
                </h2>
                <div class="flashcard-counter" id="flashcardCounter">
                    Card 1 of {{ flashcard_results|length }}
                </div>
            </div>

            <!-- Progress Bar -->
            <div class="progress-container">
                <div class="progress-label">
                    <span class="progress-title">Study Progress</span>
                    <span class="progress-percentage" id="progressPercentage">0%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>

            <!-- Flashcard -->
            <div class="flashcard" id="currentFlashcard" onclick="flipCard()">
                <div class="flashcard-inner">
                    <div class="flashcard-front">
                        <div id="flashcardFront"></div>
                        <div class="flip-hint">
                            <i class="fas fa-sync-alt"></i>
                            Click to flip
                        </div>
                    </div>
                    <div class="flashcard-back">
                        <div id="flashcardBack"></div>
                        <div class="flip-hint">
                            <i class="fas fa-sync-alt"></i>
                            Click to flip back
                        </div>
                    </div>
                </div>
            </div>

            <!-- Navigation Controls -->
            <div class="flashcard-nav">
                <button class="nav-btn prev" id="prevBtn" onclick="previousCard()" title="Previous Card">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <button class="nav-btn flip" id="flipBtn" onclick="flipCard()" title="Flip Card">
                    <i class="fas fa-sync-alt"></i>
                </button>
                <button class="nav-btn next" id="nextBtn" onclick="nextCard()" title="Next Card">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>

            <!-- Keyboard Shortcuts -->
            <div class="keyboard-shortcuts">
                <div class="shortcuts-title">
                    <i class="fas fa-keyboard"></i>
                    Keyboard Shortcuts
                </div>
                <div class="shortcuts-list">
                    <div class="shortcut-item">
                        <span class="shortcut-key">‚Üê</span>
                        <span>Previous</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="shortcut-key">‚Üí</span>
                        <span>Next</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="shortcut-key">Space</span>
                        <span>Flip</span>
                    </div>
                </div>
            </div>

            <!-- Download Section -->
            <div class="download-section">
                <h3 class="download-title">
                    <i class="fas fa-download"></i>
                    Export Your Flashcards
                </h3>
                <p class="download-description">
                    Save your flashcards for offline study or share them with classmates
                </p>
                <div class="download-buttons">
                    <button class="download-btn" onclick="downloadPDF()">
                        <i class="fas fa-file-pdf"></i>
                        Download PDF
                    </button>
                    <button class="download-btn" onclick="downloadImages()">
                        <i class="fas fa-images"></i>
                        Download Images
                    </button>
                    <button class="download-btn" onclick="downloadText()">
                        <i class="fas fa-file-text"></i>
                        Download Text
                    </button>
                </div>
            </div>
        </div>

        <script>
            // Flashcard data from Django
            const flashcards = {{ flashcard_results|safe }};
            let currentCardIndex = 0;
            let isFlipped = false;

            // Initialize flashcards
            function initFlashcards() {
                if (flashcards && flashcards.length > 0) {
                    showCard(currentCardIndex);
                    updateProgress();
                }
            }

            // Show specific card
            function showCard(index) {
                if (index >= 0 && index < flashcards.length) {
                    currentCardIndex = index;
                    isFlipped = false;
                    
                    const card = flashcards[index];
                    document.getElementById('flashcardFront').textContent = card.front;
                    document.getElementById('flashcardBack').textContent = card.back;
                    
                    // Reset flip state
                    const flashcard = document.getElementById('currentFlashcard');
                    flashcard.classList.remove('flipped');
                    
                    updateNavigation();
                    updateProgress();
                    updateCounter();
                }
            }

            // Flip current card
            function flipCard() {
                const flashcard = document.getElementById('currentFlashcard');
                isFlipped = !isFlipped;
                flashcard.classList.toggle('flipped', isFlipped);
                
                // Add flip animation to button
                const flipBtn = document.getElementById('flipBtn');
                flipBtn.style.transform = 'rotate(180deg)';
                setTimeout(() => {
                    flipBtn.style.transform = 'rotate(0deg)';
                }, 300);
            }

            // Navigate to previous card
            function previousCard() {
                if (currentCardIndex > 0) {
                    showCard(currentCardIndex - 1);
                    
                    // Add animation feedback
                    const prevBtn = document.getElementById('prevBtn');
                    prevBtn.style.transform = 'scale(0.9)';
                    setTimeout(() => {
                        prevBtn.style.transform = 'scale(1)';
                    }, 150);
                }
            }

            // Navigate to next card
            function nextCard() {
                if (currentCardIndex < flashcards.length - 1) {
                    showCard(currentCardIndex + 1);
                    
                    // Add animation feedback
                    const nextBtn = document.getElementById('nextBtn');
                    nextBtn.style.transform = 'scale(0.9)';
                    setTimeout(() => {
                        nextBtn.style.transform = 'scale(1)';
                    }, 150);
                }
            }

            // Update navigation buttons
            function updateNavigation() {
                document.getElementById('prevBtn').disabled = currentCardIndex === 0;
                document.getElementById('nextBtn').disabled = currentCardIndex === flashcards.length - 1;
            }

            // Update progress bar
            function updateProgress() {
                const progress = ((currentCardIndex + 1) / flashcards.length) * 100;
                document.getElementById('progressFill').style.width = progress + '%';
                document.getElementById('progressPercentage').textContent = Math.round(progress) + '%';
            }

            // Update card counter
            function updateCounter() {
                document.getElementById('flashcardCounter').textContent = 
                    `Card ${currentCardIndex + 1} of ${flashcards.length}`;
            }

            // Download functions
            function downloadPDF() {
                showDownloadMessage('PDF download feature coming soon! üìÑ');
            }

            function downloadImages() {
                showDownloadMessage('Image download feature coming soon! üñºÔ∏è');
            }

            function downloadText() {
                // Create text content
                let textContent = 'Lamla AI Flashcards\n';
                textContent += '===================\n\n';
                
                flashcards.forEach((card, index) => {
                    textContent += `Card ${index + 1}:\n`;
                    textContent += `Front: ${card.front}\n`;
                    textContent += `Back: ${card.back}\n\n`;
                });
                
                // Create and download file
                const blob = new Blob([textContent], { type: 'text/plain' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'lamla-ai-flashcards.txt';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
                
                showDownloadMessage('Flashcards downloaded as text file! üìù');
            }

            function showDownloadMessage(message) {
                // Create temporary message
                const messageDiv = document.createElement('div');
                messageDiv.style.cssText = `
                    position: fixed;
                    top: 100px;
                    right: 20px;
                    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
                    color: white;
                    padding: 16px 24px;
                    border-radius: 12px;
                    box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
                    z-index: 10000;
                    font-weight: 600;
                    animation: slideIn 0.3s ease;
                `;
                messageDiv.textContent = message;
                
                document.body.appendChild(messageDiv);
                
                setTimeout(() => {
                    messageDiv.remove();
                }, 3000);
            }

            // Keyboard navigation
            document.addEventListener('keydown', function(e) {
                // Prevent default behavior when flashcards are displayed
                if (flashcards && flashcards.length > 0) {
                    switch(e.key) {
                        case 'ArrowLeft':
                            e.preventDefault();
                            previousCard();
                            break;
                        case 'ArrowRight':
                            e.preventDefault();
                            nextCard();
                            break;
                        case ' ':
                            e.preventDefault();
                            flipCard();
                            break;
                    }
                }
            });

            // Form submission with loading state
            document.getElementById('flashcardForm').addEventListener('submit', function() {
                const btn = document.getElementById('generateBtn');
                const originalText = btn.innerHTML;
                
                btn.innerHTML = '<div class="loading-spinner"></div> Generating Flashcards...';
                btn.disabled = true;
                
                // Re-enable button after 30 seconds as fallback
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                }, 30000);
            });

            // Initialize when page loads
            document.addEventListener('DOMContentLoaded', function() {
                initFlashcards();
                
                // Add CSS for slide animation
                const style = document.createElement('style');
                style.textContent = `
                    @keyframes slideIn {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                `;
                document.head.appendChild(style);
            });
        </script>
        {% endif %}

        {% if error_message %}
        <!-- Error Message -->
        <div class="error-message">
            <div class="error-icon">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <div>{{ error_message|safe }}</div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
